From 2122ad7e07043f9b29a4ec4fac1a43cc38e4a415 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Daniel=20D=C3=ADaz?= <daniel.diaz@linaro.org>
Date: Thu, 4 May 2017 00:57:39 -0500
Subject: [PATCH 1/2] workaround: undefine PIGLIT_HAS_GBM_BO_MAP
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This workaround is needed for Hikey and
mali450-userland r6p0_01rel0.

It's safe to assume that any GBM version >= 12.1 will include
a definition of gbm_bo_map() and gbm_bo_unmap. However, in
the case of libMali and a few companions, said definition can
be found in the header file but not in the library itself.
This leads to errors like the following when building:
  undefined reference to `gbm_bo_unmap'

Simply undefining PIGLIT_HAS_GBM_BO_MAP let's Piglit build
correctly and carry on doing Piglit stuff.

Signed-off-by: Daniel DÃ­az <daniel.diaz@linaro.org>
---
 CMakeLists.txt | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 983f4a3..8140314 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -141,10 +141,6 @@ IF(${CMAKE_SYSTEM_NAME} MATCHES "Linux")
 	if(GBM_FOUND)
 		set(PIGLIT_HAS_GBM True)
 		add_definitions(-DPIGLIT_HAS_GBM)
-		if (GBM_VERSION VERSION_EQUAL "12.1" OR GBM_VERSION VERSION_GREATER "12.1")
-			set(PIGLIT_HAS_GBM_BO_MAP True)
-			add_definitions(-DPIGLIT_HAS_GBM_BO_MAP)
-		endif()
 	endif(GBM_FOUND)
 
 	pkg_check_modules(WAYLAND QUIET wayland-client wayland-egl)
-- 
1.9.1

